#!/bin/bash
# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Gitleaks
# Ð¦ÐµÐ¹ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡ÑƒÑ”, Ñ‰Ð¾ gitleaks Ð±ÑƒÐ´Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð´Ð»Ñ Ð²ÑÑ–Ñ… git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—Ð²

echo "ðŸŒ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ Gitleaks..."

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ñ‡Ð¸ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ gitleaks
if ! command -v gitleaks &> /dev/null; then
    echo "âŒ ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: gitleaks Ð½Ðµ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾"
    echo "Ð¡Ð¿Ð¾Ñ‡Ð°Ñ‚ÐºÑƒ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ: brew install gitleaks"
    exit 1
fi

# Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð²
echo "ðŸ“ Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ñ… Ñ„Ð°Ð¹Ð»Ñ–Ð²..."

# Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð¿Ð°Ð¿ÐºÐ¸ Ð´Ð»Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ñ… hooks
mkdir -p ~/.git-hooks

# ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ð½Ð½Ñ pre-commit hook
cp /Users/arakviel/.git-hooks/pre-commit ~/.git-hooks/pre-commit 2>/dev/null || {
    echo "ðŸ“‹ Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ pre-commit hook..."
    cat > ~/.git-hooks/pre-commit << 'EOF'
#!/bin/bash
# Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ð¹ Gitleaks pre-commit hook
# Ð¦ÐµÐ¹ Ñ…ÑƒÐº Ð±ÑƒÐ´Ðµ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð´Ð»Ñ Ð²ÑÑ–Ñ… git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—Ð²

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ñ‡Ð¸ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ gitleaks
if ! command -v gitleaks &> /dev/null; then
    echo "âŒ ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: gitleaks Ð½Ðµ Ð²ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾ Ð°Ð±Ð¾ Ð½Ðµ Ð² PATH"
    exit 1
fi

# ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ñ‡Ð¸ Ð¼Ð¸ Ð² git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—
if [ ! -d ".git" ]; then
    echo "âŒ ÐŸÐ¾Ð¼Ð¸Ð»ÐºÐ°: Ð½Ðµ Ð² git Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ñ—"
    exit 1
fi

echo "ðŸ” Ð¡ÐºÐ°Ð½ÑƒÐ²Ð°Ð½Ð½Ñ Ð½Ð° ÑÐµÐºÑ€ÐµÑ‚Ð¸ Ð· Gitleaks..."

# Ð—Ð°Ð¿ÑƒÑÐº gitleaks Ð½Ð° staged Ñ„Ð°Ð¹Ð»Ð°Ñ…
if ! gitleaks git --pre-commit; then
    echo "âŒ Gitleaks Ð·Ð½Ð°Ð¹ÑˆÐ¾Ð² ÑÐµÐºÑ€ÐµÑ‚Ð¸ Ñƒ Ð²Ð°ÑˆÐ¸Ñ… staged Ñ„Ð°Ð¹Ð»Ð°Ñ…!"
    echo "Ð‘ÑƒÐ´ÑŒ Ð»Ð°ÑÐºÐ°, Ð²Ð¸Ð´Ð°Ð»Ñ–Ñ‚ÑŒ ÑÐµÐºÑ€ÐµÑ‚Ð¸ Ñ‚Ð° ÑÐ¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð·Ð½Ð¾Ð²Ñƒ."
    exit 1
fi

echo "âœ… Ð¡ÐµÐºÑ€ÐµÑ‚Ñ–Ð² Ð½Ðµ Ð·Ð½Ð°Ð¹Ð´ÐµÐ½Ð¾. ÐšÐ¾Ð¼Ð¼Ñ–Ñ‚ Ð´Ð¾Ð·Ð²Ð¾Ð»ÐµÐ½Ð¾."
exit 0
EOF
    chmod +x ~/.git-hooks/pre-commit
}

# ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ð½Ð½Ñ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—
if [ ! -f ~/.gitleaks.toml ]; then
    echo "ðŸ“‹ ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ð½Ð½Ñ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—..."
    cp Helpers/Security/.gitleaks.toml ~/.gitleaks.toml
fi

# ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ð½Ð½Ñ ignore Ñ„Ð°Ð¹Ð»Ñƒ
if [ ! -f ~/.gitleaksignore ]; then
    echo "ðŸ“‹ ÐšÐ¾Ð¿Ñ–ÑŽÐ²Ð°Ð½Ð½Ñ ignore Ñ„Ð°Ð¹Ð»Ñƒ..."
    cat > ~/.gitleaksignore << 'EOF'
# Gitleaks ignore file - Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ð¹
# Ð¦ÐµÐ¹ Ñ„Ð°Ð¹Ð» Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°Ñ”, Ñ‰Ð¾ gitleaks Ð¼Ð°Ñ” Ñ–Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ„Ð°Ð¹Ð»Ð¸ Ð·Ð²Ñ–Ñ‚Ñ–Ð²
*.log
*.out
*.tmp

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ„Ð°Ð¹Ð»Ð¸ ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ— ÑÐµÑ€ÐµÐ´Ð¾Ð²Ð¸Ñ‰
.env*
*.env.local
*.env.development
*.env.production

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð°Ð¿ÐºÐ¸ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚ÐµÐ¹
node_modules/
vendor/
.npm/
.yarn/
bower_components/

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸
.DS_Store
Thumbs.db
.vscode/
.idea/

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð°Ñ€Ñ…Ñ–Ð²Ð¸
*.zip
*.tar.gz
*.rar
*.7z

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ð±Ñ–Ð½Ð°Ñ€Ð½Ñ– Ñ„Ð°Ð¹Ð»Ð¸
*.exe
*.dll
*.so
*.dylib

# Ð†Ð³Ð½Ð¾Ñ€ÑƒÐ²Ð°Ñ‚Ð¸ Ñ‚Ð¸Ð¼Ñ‡Ð°ÑÐ¾Ð²Ñ– Ñ„Ð°Ð¹Ð»Ð¸
*~
*.swp
*.swo
EOF
fi

# ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ git
echo "ðŸ”§ ÐÐ°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ git ÐºÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ—..."

# Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð³Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¾Ð³Ð¾ hooksPath
git config --global core.hooksPath ~/.git-hooks

# Ð¡Ñ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ Ð°Ð»Ð¸Ð°ÑÑƒ
git config --global alias.gitleaks '!gitleaks git'

echo "âœ… Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ðµ Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Gitleaks Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾!"
echo ""
echo "ðŸ“‹ Ð©Ð¾ Ð±ÑƒÐ»Ð¾ Ð½Ð°Ð»Ð°ÑˆÑ‚Ð¾Ð²Ð°Ð½Ð¾:"
echo "  â€¢ Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð¸Ð¹ pre-commit hook (~/.git-hooks/pre-commit)"
echo "  â€¢ ÐšÐ¾Ð½Ñ„Ñ–Ð³ÑƒÑ€Ð°Ñ†Ñ–Ñ Gitleaks (~/.gitleaks.toml)"
echo "  â€¢ Ignore Ñ„Ð°Ð¹Ð» (~/.gitleaksignore)"
echo "  â€¢ Git Ð°Ð»Ð¸Ð°Ñ: git gitleaks"
echo "  â€¢ Global hooksPath: ~/.git-hooks"
echo ""
echo "ðŸ” ÐŸÐµÑ€ÐµÐ²Ñ–Ñ€ÐºÐ° Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸:"
echo "  git gitleaks"
echo ""
echo "ðŸ’¡ Ð¢ÐµÐ¿ÐµÑ€ gitleaks Ð±ÑƒÐ´Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð¿Ñ€Ð°Ñ†ÑŽÐ²Ð°Ñ‚Ð¸ Ð¿Ñ€Ð¸ ÐºÐ¾Ð¶Ð½Ð¾Ð¼Ñƒ ÐºÐ¾Ð¼Ð¼Ñ–Ñ‚Ñ– Ñƒ Ð²ÑÑ–Ñ… Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–ÑÑ…!"